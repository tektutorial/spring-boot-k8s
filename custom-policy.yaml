apiVersion: kuma.io/v1alpha1
kind: ProxyTemplate
mesh: default
metadata:
  name: backend-lua-filter
spec:
  selectors:
    - match:
        kuma.io/service: spring-deployment-new-service_kuma-demo7_svc_8085
  conf:
    imports:
      - default-proxy # apply modifications on top of resources generated by Kuma
      #- ingress # apply modifications on top of resources generated by Kuma
    modifications:
      - httpFilter:
          operation: addBefore
          match:
            #listenerName: inbound:127.0.0.1:80
            name: envoy.filters.http.router
            origin: inbound
          value: |
            name: envoy.filters.http.lua
            typedConfig:
              '@type': type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua
              inline_code: |
                function envoy_on_request(request_handle)
                  request_handle:headers():add("x-header", "test")
                end